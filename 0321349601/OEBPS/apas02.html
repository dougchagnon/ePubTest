<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Field and Method Annotations</title><link rel="stylesheet" href="styles/convert.css" type="text/css"/></head><body><div class="section" title="Field and Method Annotations"><div class="titlepage"><div><div><h2 class="title"><a id="app01lev1sec2"/>Field and Method Annotations</h2></div></div></div>

<p>The class-level annotations above are part of the public documentation for the class. Other aspects of a classâ€™s thread-safety strategy are entirely for maintainers and are not part of its public documentation.</p>
<p>Classes that use locking should document which state variables are guarded with which locks, and which locks are used to guard those variables. A common source of inadvertent non-thread-safety is when a thread-safe class consistently uses locking to guard its state, but is later modified to add either new state variables that are not adequately guarded by locking, or new methods that do not <a id="iddle1096" class="indexterm"/>use locking properly to guard the existing state variables. Documenting which variables are guarded by which locks can help prevent both types of omissions.</p>
<p><code class="literal">@GuardedBy(lock)</code> documents that a field or method should be accessed only with a specific lock held. The <code class="literal">lock</code> argument identifies the lock that should be held when accessing the annotated field or method. The possible values for <code class="literal">lock</code> are:</p>
<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">@GuardedBy("this")</code>, meaning the intrinsic lock on the containing object (the object of which the method or field is a member);</p></li><li class="listitem"><p><code class="literal">@GuardedBy("</code><span class="emphasis"><em><code class="literal">fieldName</code></em></span><code class="literal">")</code>, meaning the lock associated with the object referenced by the named field, either an intrinsic lock (for fields that do not refer to a <code class="literal">Lock</code>) or an explicit <code class="literal">Lock</code> (for fields that refer to a <code class="literal">Lock</code>);</p></li><li class="listitem"><p><code class="literal">@GuardedBy("</code><span class="emphasis"><em><code class="literal">ClassName.fieldName</code></em></span><code class="literal">")</code>, like <code class="literal">@GuardedBy("fieldName")</code>, but referencing a lock object held in a static field of another class;</p></li><li class="listitem"><p><code class="literal">@GuardedBy("</code><span class="emphasis"><em><code class="literal">methodName</code></em></span><code class="literal">()")</code>, meaning the lock object that is returned by calling the named method;</p></li><li class="listitem"><p><code class="literal">@GuardedBy("</code><span class="emphasis"><em><code class="literal">ClassName</code></em></span><code class="literal">.class")</code>, meaning the class literal object for the named class.</p></li></ul></div>
<p class="continued">Using <code class="literal">@GuardedBy</code> to identify each state variable that needs locking and which lock guards it can assist in maintenance and code reviews, and can help automated analysis tools spot potential thread-safety errors.</p>
</div></body></html>
